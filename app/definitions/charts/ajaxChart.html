<article class="col-xs-{{chart.smallSize}} col-sm-{{chart.mediumSize}} col-md-{{chart.mediumSize}} col-lg-{{chart.mediumSize}}">

    <!-- Widget ID (each widget will need unique ID)-->
    <div class="jarviswidget jarviswidget-color-blue" id="wid-id-{{chart.number}}" data-widget-fullscreenbutton="false" data-widget-editbutton="false" data-widget-deletebutton="false">
        <header>
            <span class="widget-icon"> <i class="fa fa-bar-chart-o"></i> </span>
            <h2>{{chart.title}}</h2>

        </header>

        <!-- widget div-->
        <div>
            <!-- end widget edit box -->

            <!-- widget edit box -->
            <div class="jarviswidget-editbox">
                <!-- This area used as dropdown edit box -->
            </div>

            <!-- widget content -->
            <div id="xwid-id-{{chart.number}}" class="widget-body no-padding">

                <span id="s{{chart.id}}" style="display: block;margin:5px;min-height:{{chart.height}}px">

                </span>

                <div class="note" style="padding:10px;min-height:35px;">
                    <a id="btn_refresh{{chart.id}}" class="btn btn-info btn-xs">
                        <i class="fa fa-refresh"></i>
                    </a>
                    <a id="btn_play{{chart.id}}" class="btn btn-info btn-xs">
                        <i class="fa fa-play"></i>
                    </a>
                    <span id="info_{{chart.id}}">

                    </span>
                </div>

            </div>
            <!-- end widget content -->

        </div>
        <!-- end widget div -->

    </div>
    <!-- end widget -->

</article>

<script type="text/javascript">

    var inter{{chart.id}} = setInterval(function(){
        if(typeof $ != 'undefined' && typeof Chart != 'undefined' && typeof jxcore != 'undefinde'){
            if(jxcore.IsConnected){
                clearInterval(inter{{chart.id}});
                setTimeout(function(){
                    render{{chart.id}}();
                },10);
            }
        }
    }, 10);


    var render{{chart.id}} = function() {

        function getData(index, cb){
            jxcore.Call("getChartData", {chartName:"{{chart.id}}", id:index}, function(ret_val){

                if(ret_val.err){
                    alert(ret_val.err);
                    location.href = "/index.html";
                }

                cb(ret_val);
            });
        };

        var render = function(index){
            getData(index, function(ret_val){

                var infoBox = document.getElementById("info_{{chart.id}}");
                infoBox.innerHTML = ret_val.data.l;

                if(!window.panelCharts["{{chart.id}}"] || !ret_val.data.update){


                    var parent = document.getElementById("s{{chart.id}}");

                    var ctx, width, height;
                    if(window.panelCharts["{{chart.id}}"])
                    {
                        ctx = document.getElementById("{{chart.id}}");
                        width = parseInt(ctx.style.width);
                        height = parseInt(ctx.style.height);
                        parent.removeChild(ctx);
                    }
                    else{
                        var cbody = document.getElementById('xwid-id-{{chart.number}}');

                        width = parent.clientWidth - 20;
                        height = parent.clientHeight;

                        if(ret_val.data.names){
                            height -= 25;
                            var sel = document.createElement("select");
                            sel.className = "form-control";
                            var names = ret_val.data.names;
                            for(var o in names){
                                var opt = document.createElement("option");
                                opt.value = o;
                                opt.innerHTML = names[o];
                                sel.appendChild(opt);
                            }
                            parent.appendChild(sel);
                            sel.onchange = function(ee){
                                var _sel = window.panelCharts["sel_{{chart.id}}"];
                                if(_sel){
                                    render(_sel.selectedIndex);
                                }
                            };
                            window.panelCharts["sel_{{chart.id}}"] = sel;
                        }
                    }

                    ctx = document.createElement('canvas');
                    ctx.id = "{{chart.id}}";
                    ctx.className = "chart";
                    ctx.width = width;
                    ctx.height = height;

                    parent.appendChild(ctx);

                    window.panelCharts["{{chart.id}}"] = new Chart(ctx.getContext("2d")).{{chart.type}}(ret_val.data.d, ret_val.options);
                }
                else{
                    var chart = window.panelCharts["{{chart.id}}"];
                    var data = ret_val.data.d;

                    if(data.datasets)
                    {
                        for(var o in data.datasets){
                            chart.addData(data.datasets[o], data.labels[o])
                        }
                    }
                    else
                    {
                        for(var o in data){
                            chart.addData(data[o]);
                        }
                    }

                    chart.update();
                }
            });
        };

        document.getElementById("btn_refresh{{chart.id}}").onmousedown = function(){
            var _sel = window.panelCharts["sel_{{chart.id}}"];
            var si = 0;
            if(_sel)
                si = _sel.selectedIndex;
            render(si);
        };

        render(0);

    };
</script>