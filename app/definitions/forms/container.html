<article class="col-sm-12 col-md-16 col-lg-12">

    <script>
        if(!window.jxForms){
            window.jxForms = {};
        }

        window.jxForms["{{form.id}}"] = {
            controls:{},
            apply:function(){
                var _this = window.jxForms["{{form.id}}"];

                var values = {};
                var failed = false;
                window.jxAddMessage();

                for(var o in _this.controls){
                    var type = _this.controls[o].type;
                    var required = _this.controls[o].required;
                    var name = _this.controls[o].name;
                    var _t = _this.controls[o]._t;

                    if(type == 'text' || type == 'password' || type == 'textarea'){
                        values[_t] = document.getElementById(o).value;
                        if(required && !values[_t].trim().length){
                            window.jxAddMessage('danger',  name + ":: {{label.ValueRequired}}");
                            failed = true;
                        }
                    }
                    else if (type == 'select'){
                        var index = document.getElementById(o).selectedIndex;
                        var value = document.getElementById(o).value;

                        if(required && index <= 0){
                            window.jxAddMessage('danger',  name + ":: {{label.ValueRequired}}");
                            failed = true;
                        }
                        else{
                            if(index<=0)
                                values[_t] = "";
                            else
                                values[_t] = value;
                        }
                    }
                    else if (type == 'checkbox'){
                        var value = document.getElementById(o).checked;

                        if(required && !value){
                            window.jxAddMessage('danger',  name + ":: {{label.ValueRequired}}");
                            failed = true;
                        }
                        else{
                            values[_t] = value;
                        }
                    }
                }

                if(!failed){
                    jxcore.Call('sessionApply', {form: '{{form.id}}', controls: values }, function (param) {
                        if(!param.arr)
                            window.jxAddMessage(param.err ? 'danger' : 'success', param.err ? param.err : JSON.stringify(param));
                        else
                        {
                            for(var o in param.arr){
                                window.jxAddMessage('danger', param.arr[o].control + ":" + param.arr[o].msg);
                            }
                        }
                    });
                }
            }
        };
    </script>
    <!-- Widget ID (each widget will need unique ID)-->
    <div class="jarviswidget jarviswidget-color-blue" id="wid-id-0" data-widget-togglebutton="false" data-widget-editbutton="false" data-widget-deletebutton="false">

        <header>
            {{form.icon}}
            <h2><strong>{{form.name}}</strong></h2>

        </header>

        <!-- widget div-->
        <div>

            <!-- widget edit box -->
            <div class="jarviswidget-editbox">
                <!-- This area used as dropdown edit box -->

            </div>
            <!-- end widget edit box -->

            <!-- widget content -->
            <div class="widget-body">
                <p id="jxFormMessage"></p>

                {{form.contents}}



                <div class="form-group">
                    <label class="col-md-2 control-label"></label>
                    <div class="col-md-4" style="padding-left: 0px">
                        <button type="button" class="btn btn-labeled btn-primary"  onclick="window.jxForms['{{form.id}}'].apply()">
                             <span class="btn-label">
                              <i class="glyphicon glyphicon-ok"></i>
                             </span>
                                    {{label.Apply}}
                        </button>
                        &nbsp;
                        <button type="button" class="btn btn-labeled btn-danger" onclick="location.reload()">
                             <span class="btn-label">
                              <i class="glyphicon glyphicon-remove"></i>
                             </span>
                            {{label.Cancel}}
                        </button>
                    </div>
                </div>

                <br>
            </div>
            <!-- end widget div -->

        </div>
        <!-- end widget -->

    </div>

</article>
<!-- WIDGET END -->


<script type="text/javascript">
    window.jxAddMessage = function(type, txt) {
        var p = document.getElementById('jxFormMessage');

        if (p) {
            if(!type && !txt){
                p.innerHTML = "";
                return;
            }

            p.innerHTML += "<p class='alert alert-" + type + "' style='padding:3px;margin:2px;'> <strong></strong> " + txt + " </p>";
        }
    };
</script>
